set alert {{via.adminEmail}}

# STONE

check process via_gemstone_stone matching "^/opt/.*/sys/stoned via .*$"
			ONREBOOT START
			MODE ACTIVE
			start program = "startStone -b via" as uid {{remoteUser}} and gid {{remoteUser}}
			stop program = "stopStone -b via" as uid {{remoteUser}} and gid {{remoteUser}} with timeout 90 seconds
 			if 7 restarts within 10 cycles then stop
#			if totalmem > 700 Mb then alert
			if cpu > 60% for 4 cycles then alert


# GEMS

{% for port in via.gemPorts %}

check process via_gemstone_gem_{{port}} with pidfile /opt/GsDevKit_home/server/stones/via/log/seaside{{port}}_server-{{port}}.pid
			DEPENDS on via_gemstone_stone
			ONREBOOT START
			GROUP via_gemstone_gems
			MODE ACTIVE
			start program = "todeIt via /home/seaside/gemServer --start=seaside{{port}}" as uid {{remoteUser}} and gid {{remoteUser}}
			stop program = "todeIt via /home/seaside/gemServer --stop=seaside{{port}}" as uid {{remoteUser}} and gid {{remoteUser}} with timeout 90 seconds
 			if 7 restarts within 10 cycles then stop
			if failed url http://127.0.0.1:{{port}}/ping and content == "OK" for 2 cycles then alert
#			if totalmem > 700 Mb then alert
			if cpu > 60% for 4 cycles then alert


{% endfor %}

